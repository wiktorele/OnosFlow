<script type="text/javascript">
    $(document).ready(function () {
        $("#addCriterion").click(function () {
            let lastCriterion = $("#criteria").find('.criterion:last');
            let id = 0;
            if (lastCriterion.length) {
                id = lastCriterion.data('id')+1;
            }
            $.get("/Flow/CriterionFormPartial?id="+id, function (data) {
                let content = data;
                $("#criteria").append(content);
                $("#criteria").find('.delete-criterion').last().click(function () {
                    $(this).closest('.criterion').remove();
                });
                $("#criteria").find('#selector_criteria_' + id + '__type').change(function () {
                    let value = $(this).val();
                    switch (value) {
                        case 'ETH_TYPE':
                            hideAndShow.call(this, ".value-eth-type");
                            break;
                        case 'ETH_DST':
                            hideAndShow.call(this, ".value-mac");
                            break;
                        case 'ETH_SRC':
                            hideAndShow.call(this, ".value-mac");
                            break;
                        case 'IN_PORT':
                            hideAndShow.call(this, ".value-port");
                            break;
                        case 'IPV4_SRC':
                            hideAndShow.call(this, ".value-ip");
                            break;
                        case 'IPV4_DST':
                            hideAndShow.call(this, ".value-ip");
                            break;
                        case 'IN_PORT':
                            hideAndShow.call(this, ".value-port");
                            break;
                        case 'IP_PROTOCOL':
                            hideAndShow.call(this, ".value-protocol");
                            break;
                        case 'TCP_SRC':
                            hideAndShow.call(this, ".value-tcp-port");
                            break;
                        case 'TCP_DST':
                            hideAndShow.call(this, ".value-tcp-port");
                            break;
                        case 'UDP_SRC':
                            hideAndShow.call(this, ".value-udp-port");
                            break;
                        case 'UDP_DST':
                            hideAndShow.call(this, ".value-udp-port");
                            break;
                        default:
                            console.log('Nieznany typ.');
                            break;
                    }

                });
                $("#criteria").find('#selector_criteria_' + id + '__type').trigger('change');
            });
        });
    });

    function hideAndShow(attr) {
        $(this).siblings('.criterion-value').each(function () {
            $(this).addClass('d-none');
            $(this).find(':input').prop("disabled", true);
        });
        $(this).siblings(attr).removeClass('d-none');
        console.log($(this).find(':input'));
        $(this).siblings(attr).find(':input').prop("disabled", false);
    }
</script>